{"uid":"63b1c5f8206a5d1f","name":"Validate Council Output [TonbridgeAndMallingBC-None-None]","fullName":"features/validate_council_outputs.feature:Validate Council Output","historyId":"b2d5541e3bec21fe5654b039ca862869","time":{"start":1709512158386,"stop":1709512160047,"duration":1661},"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"fixturefunc = <function scrape_step at 0x7f3f98cd87c0>\nrequest = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f3f97de9d90>, 'council': 'TonbridgeAndMallingBC', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:92: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:96: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:115: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:78: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f3f98131150>, page = ''\nkwargs = {'headless': True, 'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', ...}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2024, 3, 4, 0, 29, 20, 46312)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:73: AttributeError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"fixturefunc = <function scrape_step at 0x7f3f98cd87c0>\nrequest = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f3f97de9d90>, 'council': 'TonbridgeAndMallingBC', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:92: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:96: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:115: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:78: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f3f98131150>, page = ''\nkwargs = {'headless': True, 'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', ...}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2024, 3, 4, 0, 29, 20, 46312)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:73: AttributeError","steps":[{"name":"Given the council: TonbridgeAndMallingBC","time":{"start":1709512158386,"stop":1709512158386,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"When we scrape the data from TonbridgeAndMallingBC using None and the None is set","time":{"start":1709512158386,"stop":1709512160047,"duration":1661},"status":"failed","statusMessage":"'NoneType' object has no attribute 'find'","statusTrace":"AttributeError: 'NoneType' object has no attribute 'find'\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"host","value":"fv-az887-104"},{"name":"thread","value":"2752-MainThread"},{"name":"framework","value":"pytest-bdd"},{"name":"language","value":"cpython3"},{"name":"feature","value":"Test each council output matches expected results"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"council","value":"TonbridgeAndMallingBC"},{"name":"selenium_mode","value":"None"},{"name":"selenium_url","value":"None"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":203,"unknown":0,"total":204},"items":[{"uid":"5b0f60a029ddf619","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1572//#testresult/5b0f60a029ddf619","status":"passed","time":{"start":1708561699683,"stop":1708561702077,"duration":2394}},{"uid":"20ed06364bd435b3","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1570//#testresult/20ed06364bd435b3","status":"passed","time":{"start":1708475405521,"stop":1708475407853,"duration":2332}},{"uid":"6048edd9c9ee9fc8","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1569//#testresult/6048edd9c9ee9fc8","status":"passed","time":{"start":1708389004540,"stop":1708389006647,"duration":2107}},{"uid":"3ab338849fc8cf38","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1568//#testresult/3ab338849fc8cf38","status":"passed","time":{"start":1708302633528,"stop":1708302636150,"duration":2622}},{"uid":"669dd7835838492c","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1567//#testresult/669dd7835838492c","status":"passed","time":{"start":1708216229940,"stop":1708216232303,"duration":2363}},{"uid":"d8f12cf832933ef1","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1566//#testresult/d8f12cf832933ef1","status":"passed","time":{"start":1708129701050,"stop":1708129703508,"duration":2458}},{"uid":"5cd164df590e87c2","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1563//#testresult/5cd164df590e87c2","status":"passed","time":{"start":1708043397991,"stop":1708043400488,"duration":2497}},{"uid":"a9401d2017c4407c","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1562//#testresult/a9401d2017c4407c","status":"passed","time":{"start":1707956900324,"stop":1707956902663,"duration":2339}},{"uid":"db57fca4ab5a9eac","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1561//#testresult/db57fca4ab5a9eac","status":"passed","time":{"start":1707870627881,"stop":1707870630508,"duration":2627}},{"uid":"47a96c0b1c55956b","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1560//#testresult/47a96c0b1c55956b","status":"passed","time":{"start":1707784155505,"stop":1707784157340,"duration":1835}},{"uid":"2e65f1b9a37370b6","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1559//#testresult/2e65f1b9a37370b6","status":"passed","time":{"start":1707697784560,"stop":1707697787056,"duration":2496}},{"uid":"199b3ba6a4d8ef4b","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1556//#testresult/199b3ba6a4d8ef4b","status":"passed","time":{"start":1707611450394,"stop":1707611452587,"duration":2193}},{"uid":"6f840efa5dbc4ef5","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1554//#testresult/6f840efa5dbc4ef5","status":"passed","time":{"start":1707524865813,"stop":1707524868418,"duration":2605}},{"uid":"6051a46a1a1319c3","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1553//#testresult/6051a46a1a1319c3","status":"passed","time":{"start":1707438452851,"stop":1707438460324,"duration":7473}},{"uid":"635bc2028a6b288f","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1552//#testresult/635bc2028a6b288f","status":"passed","time":{"start":1707352117944,"stop":1707352120390,"duration":2446}},{"uid":"82897b04466e179a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1551//#testresult/82897b04466e179a","status":"passed","time":{"start":1707265634874,"stop":1707265641574,"duration":6700}},{"uid":"e25278330548af4e","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1549//#testresult/e25278330548af4e","status":"passed","time":{"start":1707179315847,"stop":1707179318412,"duration":2565}},{"uid":"deb1f372dc7460ea","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1548//#testresult/deb1f372dc7460ea","status":"passed","time":{"start":1707092995956,"stop":1707092998619,"duration":2663}},{"uid":"7971c4caa87e577a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1547//#testresult/7971c4caa87e577a","status":"passed","time":{"start":1707006834693,"stop":1707006837865,"duration":3172}},{"uid":"d8a4b736f04bd07d","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1545//#testresult/d8a4b736f04bd07d","status":"passed","time":{"start":1706942003341,"stop":1706942005354,"duration":2013}}]},"tags":[]},"source":"63b1c5f8206a5d1f.json","parameterValues":["TonbridgeAndMallingBC","None","None"]}