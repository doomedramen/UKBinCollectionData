{"uid":"e65a93c7fb2342f8","name":"Validate Council Output [BirminghamCityCouncil]","fullName":"features/validate_council_outputs.feature:Validate Council Output","historyId":"313cc1f1f7b9b6b24f90c433ebf257d0","time":{"start":1719275319690,"stop":1719275387468,"duration":67778},"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find_all'","statusTrace":"fixturefunc = <function scrape_step at 0x7f778eda7420>\nrequest = <FixtureRequest for <Function test_scenario_outline[BirminghamCityCouncil]>>\nkwargs = {'context': <test_validate_council.Context object at 0x7f7790d56e10>, 'headless_mode': 'True', 'local_browser': 'False', 'selenium_url': 'http://localhost:4444'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:887: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:100: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:101: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:121: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:61: in template_method\n    bin_data_dict = self.get_and_parse_data(this_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:82: in get_and_parse_data\n    bin_data_dict = self.parse_data(page, url=address_url, **kwargs)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <BirminghamCityCouncil.CouncilClass object at 0x7f778e188690>\npage = <Response [200]>\nkwargs = {'council_module_str': 'BirminghamCityCouncil', 'dev_mode': False, 'headless': True, 'local_browser': False, ...}\nuprn = '100070445256', postcode = 'B5 7XE'\nvalues = {'__token': '2.II3s665dIDG_lu7D5-EALhy7QdlKYyP_J1_rhjrCwCk.aOeDjusXDWLZxJTziolmbXjXMowFFU62Zj2j8WKb9WEW2bOIg25yfMXfow', 'locale': 'en_GB', 'next': 'Next', 'page': '491', ...}\nheaders = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64)'}\nresponse = <Response [504]>\nsoup = <html>\n<head><title>504 Gateway Time-out</title></head>\n<body>\n<center><h1>504 Gateway Time-out</h1></center>\n</body>\n</html>\n\n\n    def parse_data(self, page: str, **kwargs: Any) -> Dict[str, List[Dict[str, str]]]:\n        uprn: Optional[str] = kwargs.get(\"uprn\")\n        postcode: Optional[str] = kwargs.get(\"postcode\")\n    \n        if uprn is None:\n            raise ValueError(\"UPRN is required and must be a non-empty string.\")\n        if postcode is None:\n            raise ValueError(\"Postcode is required and must be a non-empty string.\")\n    \n        check_uprn(uprn)\n        check_postcode(postcode)\n    \n        values = {\n            \"__token\": get_token(page),\n            \"page\": \"491\",\n            \"locale\": \"en_GB\",\n            \"q1f8ccce1d1e2f58649b4069712be6879a839233f_0_0\": postcode,\n            \"q1f8ccce1d1e2f58649b4069712be6879a839233f_1_0\": uprn,\n            \"next\": \"Next\",\n        }\n        headers = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 6.1; Win64; x64)\"}\n        requests.packages.urllib3.disable_warnings()\n        response = requests.request(\n            \"POST\",\n            \"https://www.birmingham.gov.uk/xfp/form/619\",\n            headers=headers,\n            data=values,\n        )\n    \n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n    \n>       rows = soup.find(\"table\").find_all(\"tr\")\nE       AttributeError: 'NoneType' object has no attribute 'find_all'\n\nuk_bin_collection/uk_bin_collection/councils/BirminghamCityCouncil.py:98: AttributeError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find_all'","statusTrace":"fixturefunc = <function scrape_step at 0x7f778eda7420>\nrequest = <FixtureRequest for <Function test_scenario_outline[BirminghamCityCouncil]>>\nkwargs = {'context': <test_validate_council.Context object at 0x7f7790d56e10>, 'headless_mode': 'True', 'local_browser': 'False', 'selenium_url': 'http://localhost:4444'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:887: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:100: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:101: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:121: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:61: in template_method\n    bin_data_dict = self.get_and_parse_data(this_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:82: in get_and_parse_data\n    bin_data_dict = self.parse_data(page, url=address_url, **kwargs)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <BirminghamCityCouncil.CouncilClass object at 0x7f778e188690>\npage = <Response [200]>\nkwargs = {'council_module_str': 'BirminghamCityCouncil', 'dev_mode': False, 'headless': True, 'local_browser': False, ...}\nuprn = '100070445256', postcode = 'B5 7XE'\nvalues = {'__token': '2.II3s665dIDG_lu7D5-EALhy7QdlKYyP_J1_rhjrCwCk.aOeDjusXDWLZxJTziolmbXjXMowFFU62Zj2j8WKb9WEW2bOIg25yfMXfow', 'locale': 'en_GB', 'next': 'Next', 'page': '491', ...}\nheaders = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64)'}\nresponse = <Response [504]>\nsoup = <html>\n<head><title>504 Gateway Time-out</title></head>\n<body>\n<center><h1>504 Gateway Time-out</h1></center>\n</body>\n</html>\n\n\n    def parse_data(self, page: str, **kwargs: Any) -> Dict[str, List[Dict[str, str]]]:\n        uprn: Optional[str] = kwargs.get(\"uprn\")\n        postcode: Optional[str] = kwargs.get(\"postcode\")\n    \n        if uprn is None:\n            raise ValueError(\"UPRN is required and must be a non-empty string.\")\n        if postcode is None:\n            raise ValueError(\"Postcode is required and must be a non-empty string.\")\n    \n        check_uprn(uprn)\n        check_postcode(postcode)\n    \n        values = {\n            \"__token\": get_token(page),\n            \"page\": \"491\",\n            \"locale\": \"en_GB\",\n            \"q1f8ccce1d1e2f58649b4069712be6879a839233f_0_0\": postcode,\n            \"q1f8ccce1d1e2f58649b4069712be6879a839233f_1_0\": uprn,\n            \"next\": \"Next\",\n        }\n        headers = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 6.1; Win64; x64)\"}\n        requests.packages.urllib3.disable_warnings()\n        response = requests.request(\n            \"POST\",\n            \"https://www.birmingham.gov.uk/xfp/form/619\",\n            headers=headers,\n            data=values,\n        )\n    \n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n    \n>       rows = soup.find(\"table\").find_all(\"tr\")\nE       AttributeError: 'NoneType' object has no attribute 'find_all'\n\nuk_bin_collection/uk_bin_collection/councils/BirminghamCityCouncil.py:98: AttributeError","steps":[{"name":"Given the council","time":{"start":1719275319691,"stop":1719275319691,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"When we scrape the data from the council","time":{"start":1719275319692,"stop":1719275387468,"duration":67776},"status":"failed","statusMessage":"'NoneType' object has no attribute 'find_all'","statusTrace":"AttributeError: 'NoneType' object has no attribute 'find_all'\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"3f265a6f5b4e2790","name":"stdout","source":"3f265a6f5b4e2790.txt","type":"text/plain","size":48}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"host","value":"fv-az1788-901"},{"name":"thread","value":"2674-MainThread"},{"name":"framework","value":"pytest-bdd"},{"name":"language","value":"cpython3"},{"name":"feature","value":"Test each council output matches expected results"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"council","value":"BirminghamCityCouncil"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":0,"skipped":0,"passed":47,"unknown":0,"total":50},"items":[{"uid":"e7430186846d1a27","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1952//#testresult/e7430186846d1a27","status":"passed","time":{"start":1719189049166,"stop":1719189052416,"duration":3250}},{"uid":"c17485e4c914876a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1951//#testresult/c17485e4c914876a","status":"passed","time":{"start":1719102725505,"stop":1719102751255,"duration":25750}},{"uid":"e97cb7bb5226c4e","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1950//#testresult/e97cb7bb5226c4e","status":"passed","time":{"start":1719016100832,"stop":1719016115075,"duration":14243}},{"uid":"9ded66dd0467c9cb","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1949//#testresult/9ded66dd0467c9cb","status":"passed","time":{"start":1718929776759,"stop":1718929781751,"duration":4992}},{"uid":"fb721a08c6a870a7","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1948//#testresult/fb721a08c6a870a7","status":"passed","time":{"start":1718843302549,"stop":1718843326678,"duration":24129}},{"uid":"281182b533091405","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1947//#testresult/281182b533091405","status":"failed","statusDetails":"AttributeError: 'NoneType' object has no attribute 'get'","time":{"start":1718756976119,"stop":1718756977781,"duration":1662}},{"uid":"ee2b46827aa9ddb6","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1946//#testresult/ee2b46827aa9ddb6","status":"passed","time":{"start":1718670570388,"stop":1718670574541,"duration":4153}},{"uid":"43b4ed318642c8a3","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1945//#testresult/43b4ed318642c8a3","status":"passed","time":{"start":1718584340344,"stop":1718584344544,"duration":4200}},{"uid":"9ed65e480093a730","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1944//#testresult/9ed65e480093a730","status":"passed","time":{"start":1718497989287,"stop":1718497994011,"duration":4724}},{"uid":"edecfe90bc072676","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1943//#testresult/edecfe90bc072676","status":"passed","time":{"start":1718411341551,"stop":1718411347354,"duration":5803}},{"uid":"e1b203ee4f6461ee","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1942//#testresult/e1b203ee4f6461ee","status":"passed","time":{"start":1718324921533,"stop":1718324925557,"duration":4024}},{"uid":"66e5d5f3a136e61b","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1939//#testresult/66e5d5f3a136e61b","status":"passed","time":{"start":1718238533104,"stop":1718238536227,"duration":3123}},{"uid":"fbb07bc5cb782f08","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1938//#testresult/fbb07bc5cb782f08","status":"passed","time":{"start":1718152147867,"stop":1718152152176,"duration":4309}},{"uid":"75dd2e6506412e6f","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1937//#testresult/75dd2e6506412e6f","status":"passed","time":{"start":1718065756035,"stop":1718065760714,"duration":4679}},{"uid":"9aa2c2ccd6589360","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1936//#testresult/9aa2c2ccd6589360","status":"passed","time":{"start":1717979460737,"stop":1717979466250,"duration":5513}},{"uid":"552d0439df5513a2","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1934//#testresult/552d0439df5513a2","status":"passed","time":{"start":1717893158164,"stop":1717893163622,"duration":5458}},{"uid":"f60216d44a853105","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1933//#testresult/f60216d44a853105","status":"passed","time":{"start":1717806545354,"stop":1717806549421,"duration":4067}},{"uid":"9a08e45e852dc285","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1932//#testresult/9a08e45e852dc285","status":"passed","time":{"start":1717720159009,"stop":1717720163203,"duration":4194}},{"uid":"4611b959e545d1cf","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1927//#testresult/4611b959e545d1cf","status":"passed","time":{"start":1717633766660,"stop":1717633769461,"duration":2801}},{"uid":"74c512ae743a83f4","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1925//#testresult/74c512ae743a83f4","status":"passed","time":{"start":1717622352017,"stop":1717622357246,"duration":5229}}]},"tags":[]},"source":"e65a93c7fb2342f8.json","parameterValues":["BirminghamCityCouncil"]}