{"uid":"4fd2e97539bcf1a8","name":"Validate Council Output [CharnwoodBoroughCouncil-None-None]","fullName":"features/validate_council_outputs.feature:Validate Council Output","historyId":"7ad090e684a1fa7fb6a8e0f9ef2ec090","time":{"start":1703294041831,"stop":1703294043884,"duration":2053},"status":"failed","statusMessage":"UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value","statusTrace":"fixturefunc = <function scrape_step at 0x7f29e249c860>\nrequest = <FixtureRequest for <Function test_scenario_outline[CharnwoodBoroughCouncil-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f29e22ab010>, 'council': 'CharnwoodBoroughCouncil', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:75: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:71: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:82: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:69: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:64: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <CharnwoodBoroughCouncil.CouncilClass object at 0x7f29e22aca10>\npage = <Response [200]>\nkwargs = {'paon': None, 'postcode': None, 'uprn': None, 'url': 'https://my.charnwood.gov.uk/location?put=cbc10070067259&rememberme=0&redirect=%2F', ...}\nsoup = <!DOCTYPE html>\n\n<html lang=\"en-GB\">\n<head>\n<meta content=\"ccms/2.0.0 (Cuttlefish CMS: http://cuttlefish.com)\" name=\"g...site developed by <a href=\"https://cuttlefish.com\">Cuttlefish</a></p>\n</section>\n</div>\n</footer>\n</div></body>\n</html>\ndata = {'bins': [{'collectionDate': '27/12/2023', 'type': 'Refuse'}]}\ncurr_date = datetime.datetime(2023, 12, 23, 1, 14, 3, 881869)\nbins = <ul class=\"refuse\"><li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.cha...an</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li></ul>\nbinCollection = [<li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.charnwood.gov.uk/page...nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>]\nbin = <li class=\"last\"><strong class=\"date\">Tue 2nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>\ncollection_date = datetime.datetime(2023, 1, 2, 0, 0)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Make a BS4 object\n        soup = BeautifulSoup(page.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        curr_date = datetime.today()\n    \n        for bins in soup.find_all(\"ul\", {\"class\": \"refuse\"}):\n            binCollection = bins.find_all(\"li\")\n    \n            if binCollection:\n                for bin in binCollection:\n                    collection_date = bin.find(\"strong\", {\"class\": \"date\"}).contents[0].strip()\n                    if collection_date.lower() == \"today\":\n                        collection_date = datetime.now()\n                    elif collection_date.lower() == \"tomorrow\":\n                        collection_date = datetime.now() + timedelta(days=1)\n                    else:\n                        collection_date = datetime.strptime(remove_ordinal_indicator_from_date_string(collection_date)\n                                                            .strip(),\"%a %d %b\").replace(year=curr_date.year)\n                        if curr_date.month == 12 and collection_date.month == 1:\n>                           bin_date = bin_date + relativedelta(years=1)\nE                           UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value\n\nuk_bin_collection/uk_bin_collection/councils/CharnwoodBoroughCouncil.py:40: UnboundLocalError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value","statusTrace":"fixturefunc = <function scrape_step at 0x7f29e249c860>\nrequest = <FixtureRequest for <Function test_scenario_outline[CharnwoodBoroughCouncil-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f29e22ab010>, 'council': 'CharnwoodBoroughCouncil', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:75: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:71: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:82: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:69: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:64: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <CharnwoodBoroughCouncil.CouncilClass object at 0x7f29e22aca10>\npage = <Response [200]>\nkwargs = {'paon': None, 'postcode': None, 'uprn': None, 'url': 'https://my.charnwood.gov.uk/location?put=cbc10070067259&rememberme=0&redirect=%2F', ...}\nsoup = <!DOCTYPE html>\n\n<html lang=\"en-GB\">\n<head>\n<meta content=\"ccms/2.0.0 (Cuttlefish CMS: http://cuttlefish.com)\" name=\"g...site developed by <a href=\"https://cuttlefish.com\">Cuttlefish</a></p>\n</section>\n</div>\n</footer>\n</div></body>\n</html>\ndata = {'bins': [{'collectionDate': '27/12/2023', 'type': 'Refuse'}]}\ncurr_date = datetime.datetime(2023, 12, 23, 1, 14, 3, 881869)\nbins = <ul class=\"refuse\"><li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.cha...an</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li></ul>\nbinCollection = [<li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.charnwood.gov.uk/page...nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>]\nbin = <li class=\"last\"><strong class=\"date\">Tue 2nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>\ncollection_date = datetime.datetime(2023, 1, 2, 0, 0)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Make a BS4 object\n        soup = BeautifulSoup(page.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        curr_date = datetime.today()\n    \n        for bins in soup.find_all(\"ul\", {\"class\": \"refuse\"}):\n            binCollection = bins.find_all(\"li\")\n    \n            if binCollection:\n                for bin in binCollection:\n                    collection_date = bin.find(\"strong\", {\"class\": \"date\"}).contents[0].strip()\n                    if collection_date.lower() == \"today\":\n                        collection_date = datetime.now()\n                    elif collection_date.lower() == \"tomorrow\":\n                        collection_date = datetime.now() + timedelta(days=1)\n                    else:\n                        collection_date = datetime.strptime(remove_ordinal_indicator_from_date_string(collection_date)\n                                                            .strip(),\"%a %d %b\").replace(year=curr_date.year)\n                        if curr_date.month == 12 and collection_date.month == 1:\n>                           bin_date = bin_date + relativedelta(years=1)\nE                           UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value\n\nuk_bin_collection/uk_bin_collection/councils/CharnwoodBoroughCouncil.py:40: UnboundLocalError","steps":[{"name":"Given the council: CharnwoodBoroughCouncil","time":{"start":1703294041831,"stop":1703294041832,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"When we scrape the data from CharnwoodBoroughCouncil using None and the None is set","time":{"start":1703294041832,"stop":1703294043884,"duration":2052},"status":"failed","statusMessage":"cannot access local variable 'bin_date' where it is not associated with a value","statusTrace":"UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"host","value":"fv-az914-521"},{"name":"thread","value":"2670-MainThread"},{"name":"framework","value":"pytest-bdd"},{"name":"language","value":"cpython3"},{"name":"feature","value":"Test each council output matches expected results"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"council","value":"CharnwoodBoroughCouncil"},{"name":"selenium_mode","value":"None"},{"name":"selenium_url","value":"None"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":8,"broken":0,"skipped":0,"passed":82,"unknown":0,"total":90},"items":[{"uid":"cc8291ca8b36f5b3","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1282//#testresult/cc8291ca8b36f5b3","status":"failed","statusDetails":"UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value","time":{"start":1703207778171,"stop":1703207779976,"duration":1805}},{"uid":"4e9970c20eeb2ee7","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1281//#testresult/4e9970c20eeb2ee7","status":"failed","statusDetails":"UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value","time":{"start":1703121415586,"stop":1703121417135,"duration":1549}},{"uid":"437e89d53d5d5fb6","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1280//#testresult/437e89d53d5d5fb6","status":"failed","statusDetails":"UnboundLocalError: cannot access local variable 'bin_date' where it is not associated with a value","time":{"start":1703034238997,"stop":1703034241185,"duration":2188}},{"uid":"195258a16065d6c7","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1279//#testresult/195258a16065d6c7","status":"passed","time":{"start":1703024886799,"stop":1703024888422,"duration":1623}},{"uid":"faf7167f58dcb95d","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1278//#testresult/faf7167f58dcb95d","status":"passed","time":{"start":1703024854827,"stop":1703024856303,"duration":1476}},{"uid":"58d6baa2bb579d85","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1276//#testresult/58d6baa2bb579d85","status":"passed","time":{"start":1702948668057,"stop":1702948669995,"duration":1938}},{"uid":"50d5c1a0e59b55bf","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1275//#testresult/50d5c1a0e59b55bf","status":"passed","time":{"start":1702862333104,"stop":1702862334559,"duration":1455}},{"uid":"3f1377851cb57a74","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1274//#testresult/3f1377851cb57a74","status":"passed","time":{"start":1702859983870,"stop":1702859985465,"duration":1595}},{"uid":"703e44b35e467338","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1272//#testresult/703e44b35e467338","status":"passed","time":{"start":1702843546096,"stop":1702843548067,"duration":1971}},{"uid":"f47377b19d8c1f76","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1270//#testresult/f47377b19d8c1f76","status":"passed","time":{"start":1702809356559,"stop":1702809357934,"duration":1375}},{"uid":"7760234bf7a86b23","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1247//#testresult/7760234bf7a86b23","status":"passed","time":{"start":1702657115381,"stop":1702657117459,"duration":2078}},{"uid":"7ddb1f5449a2f9bf","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1248//#testresult/7ddb1f5449a2f9bf","status":"passed","time":{"start":1702657144055,"stop":1702657145683,"duration":1628}},{"uid":"9190372f41da002f","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1244//#testresult/9190372f41da002f","status":"passed","time":{"start":1702603164428,"stop":1702603165899,"duration":1471}},{"uid":"88b5e4cc040cbba","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1243//#testresult/88b5e4cc040cbba","status":"passed","time":{"start":1702540025178,"stop":1702540026841,"duration":1663}},{"uid":"caed22a9cbf7c34c","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1241//#testresult/caed22a9cbf7c34c","status":"passed","time":{"start":1702516656934,"stop":1702516658394,"duration":1460}},{"uid":"c1c4bee16f50b468","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1238//#testresult/c1c4bee16f50b468","status":"passed","time":{"start":1702447454933,"stop":1702447456567,"duration":1634}},{"uid":"5b284ebdc030b387","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1236//#testresult/5b284ebdc030b387","status":"passed","time":{"start":1702430310229,"stop":1702430312075,"duration":1846}},{"uid":"40e823290a16741c","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1232//#testresult/40e823290a16741c","status":"passed","time":{"start":1702366466193,"stop":1702366468068,"duration":1875}},{"uid":"1e979a6ad5874d5e","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1231//#testresult/1e979a6ad5874d5e","status":"passed","time":{"start":1702343931842,"stop":1702343933500,"duration":1658}},{"uid":"b8e4ef04a8f76b81","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/1229//#testresult/b8e4ef04a8f76b81","status":"passed","time":{"start":1702257520510,"stop":1702257522348,"duration":1838}}]},"tags":[]},"source":"4fd2e97539bcf1a8.json","parameterValues":["CharnwoodBoroughCouncil","None","None"]}