{"uid":"120f6c25e7b7a91e","name":"Validate Council Output [CharnwoodBoroughCouncil-None-None]","fullName":"features/validate_council_outputs.feature:Validate Council Output","historyId":"7ad090e684a1fa7fb6a8e0f9ef2ec090","time":{"start":1703380883750,"stop":1703380885669,"duration":1919},"status":"failed","statusMessage":"UnboundLocalError: local variable 'bin_date' referenced before assignment","statusTrace":"fixturefunc = <function scrape_step at 0x7f3933a47f40>\nrequest = <FixtureRequest for <Function test_scenario_outline[CharnwoodBoroughCouncil-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f3923f51d20>, 'council': 'CharnwoodBoroughCouncil', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:75: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:71: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:82: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:69: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:64: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <CharnwoodBoroughCouncil.CouncilClass object at 0x7f39305f9930>\npage = <Response [200]>\nkwargs = {'paon': None, 'postcode': None, 'uprn': None, 'url': 'https://my.charnwood.gov.uk/location?put=cbc10070067259&rememberme=0&redirect=%2F', ...}\nsoup = <!DOCTYPE html>\n\n<html lang=\"en-GB\">\n<head>\n<meta content=\"ccms/2.0.0 (Cuttlefish CMS: http://cuttlefish.com)\" name=\"g...site developed by <a href=\"https://cuttlefish.com\">Cuttlefish</a></p>\n</section>\n</div>\n</footer>\n</div></body>\n</html>\ndata = {'bins': [{'collectionDate': '27/12/2023', 'type': 'Refuse'}]}\ncurr_date = datetime.datetime(2023, 12, 24, 1, 21, 25, 667571)\nbins = <ul class=\"refuse\"><li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.cha...an</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li></ul>\nbinCollection = [<li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.charnwood.gov.uk/page...nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>]\nbin = <li class=\"last\"><strong class=\"date\">Tue 2nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>\ncollection_date = datetime.datetime(2023, 1, 2, 0, 0)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Make a BS4 object\n        soup = BeautifulSoup(page.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        curr_date = datetime.today()\n    \n        for bins in soup.find_all(\"ul\", {\"class\": \"refuse\"}):\n            binCollection = bins.find_all(\"li\")\n    \n            if binCollection:\n                for bin in binCollection:\n                    collection_date = bin.find(\"strong\", {\"class\": \"date\"}).contents[0].strip()\n                    if collection_date.lower() == \"today\":\n                        collection_date = datetime.now()\n                    elif collection_date.lower() == \"tomorrow\":\n                        collection_date = datetime.now() + timedelta(days=1)\n                    else:\n                        collection_date = datetime.strptime(remove_ordinal_indicator_from_date_string(collection_date)\n                                                            .strip(),\"%a %d %b\").replace(year=curr_date.year)\n                        if curr_date.month == 12 and collection_date.month == 1:\n>                           bin_date = bin_date + relativedelta(years=1)\nE                           UnboundLocalError: local variable 'bin_date' referenced before assignment\n\nuk_bin_collection/uk_bin_collection/councils/CharnwoodBoroughCouncil.py:40: UnboundLocalError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"UnboundLocalError: local variable 'bin_date' referenced before assignment","statusTrace":"fixturefunc = <function scrape_step at 0x7f3933a47f40>\nrequest = <FixtureRequest for <Function test_scenario_outline[CharnwoodBoroughCouncil-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f3923f51d20>, 'council': 'CharnwoodBoroughCouncil', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:75: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:71: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:82: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:69: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:64: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <CharnwoodBoroughCouncil.CouncilClass object at 0x7f39305f9930>\npage = <Response [200]>\nkwargs = {'paon': None, 'postcode': None, 'uprn': None, 'url': 'https://my.charnwood.gov.uk/location?put=cbc10070067259&rememberme=0&redirect=%2F', ...}\nsoup = <!DOCTYPE html>\n\n<html lang=\"en-GB\">\n<head>\n<meta content=\"ccms/2.0.0 (Cuttlefish CMS: http://cuttlefish.com)\" name=\"g...site developed by <a href=\"https://cuttlefish.com\">Cuttlefish</a></p>\n</section>\n</div>\n</footer>\n</div></body>\n</html>\ndata = {'bins': [{'collectionDate': '27/12/2023', 'type': 'Refuse'}]}\ncurr_date = datetime.datetime(2023, 12, 24, 1, 21, 25, 667571)\nbins = <ul class=\"refuse\"><li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.cha...an</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li></ul>\nbinCollection = [<li class=\"first\"><strong class=\"date\">Wed 27th Dec</strong><a class=\"refuse\" href=\"https://www.charnwood.gov.uk/page...nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>]\nbin = <li class=\"last\"><strong class=\"date\">Tue 2nd Jan</strong><a class=\"recycling\" href=\"https://www.charnwood.gov.uk/pages/recycling_information\">Recycling</a></li>\ncollection_date = datetime.datetime(2023, 1, 2, 0, 0)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Make a BS4 object\n        soup = BeautifulSoup(page.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        curr_date = datetime.today()\n    \n        for bins in soup.find_all(\"ul\", {\"class\": \"refuse\"}):\n            binCollection = bins.find_all(\"li\")\n    \n            if binCollection:\n                for bin in binCollection:\n                    collection_date = bin.find(\"strong\", {\"class\": \"date\"}).contents[0].strip()\n                    if collection_date.lower() == \"today\":\n                        collection_date = datetime.now()\n                    elif collection_date.lower() == \"tomorrow\":\n                        collection_date = datetime.now() + timedelta(days=1)\n                    else:\n                        collection_date = datetime.strptime(remove_ordinal_indicator_from_date_string(collection_date)\n                                                            .strip(),\"%a %d %b\").replace(year=curr_date.year)\n                        if curr_date.month == 12 and collection_date.month == 1:\n>                           bin_date = bin_date + relativedelta(years=1)\nE                           UnboundLocalError: local variable 'bin_date' referenced before assignment\n\nuk_bin_collection/uk_bin_collection/councils/CharnwoodBoroughCouncil.py:40: UnboundLocalError","steps":[{"name":"Given the council: CharnwoodBoroughCouncil","time":{"start":1703380883750,"stop":1703380883751,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"When we scrape the data from CharnwoodBoroughCouncil using None and the None is set","time":{"start":1703380883751,"stop":1703380885669,"duration":1918},"status":"failed","statusMessage":"local variable 'bin_date' referenced before assignment","statusTrace":"UnboundLocalError: local variable 'bin_date' referenced before assignment\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"host","value":"fv-az1110-626"},{"name":"thread","value":"2778-MainThread"},{"name":"framework","value":"pytest-bdd"},{"name":"language","value":"cpython3"},{"name":"feature","value":"Test each council output matches expected results"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"council","value":"CharnwoodBoroughCouncil"},{"name":"selenium_mode","value":"None"},{"name":"selenium_url","value":"None"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":9,"broken":0,"skipped":0,"passed":75,"unknown":0,"total":84},"items":[{"uid":"51c51dc323e20a30","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1287//#testresult/51c51dc323e20a30","status":"failed","statusDetails":"UnboundLocalError: local variable 'bin_date' referenced before assignment","time":{"start":1703294037206,"stop":1703294038702,"duration":1496}},{"uid":"495834b268328c12","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1282//#testresult/495834b268328c12","status":"failed","statusDetails":"UnboundLocalError: local variable 'bin_date' referenced before assignment","time":{"start":1703207774558,"stop":1703207776362,"duration":1804}},{"uid":"be413bea7ca469ee","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1281//#testresult/be413bea7ca469ee","status":"failed","statusDetails":"UnboundLocalError: local variable 'bin_date' referenced before assignment","time":{"start":1703121415638,"stop":1703121417304,"duration":1666}},{"uid":"7a9df3b08729c24d","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1280//#testresult/7a9df3b08729c24d","status":"failed","statusDetails":"UnboundLocalError: local variable 'bin_date' referenced before assignment","time":{"start":1703034239914,"stop":1703034241917,"duration":2003}},{"uid":"3ab13ed3fef2b7f7","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1279//#testresult/3ab13ed3fef2b7f7","status":"passed","time":{"start":1703024887017,"stop":1703024888494,"duration":1477}},{"uid":"f0fe4eece9750da7","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1276//#testresult/f0fe4eece9750da7","status":"passed","time":{"start":1702948667456,"stop":1702948669091,"duration":1635}},{"uid":"1d4304ab26b765a2","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1275//#testresult/1d4304ab26b765a2","status":"passed","time":{"start":1702862341027,"stop":1702862342566,"duration":1539}},{"uid":"3aae5938291f5fb3","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1274//#testresult/3aae5938291f5fb3","status":"passed","time":{"start":1702859983932,"stop":1702859985830,"duration":1898}},{"uid":"54ea769ed40cf7a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1272//#testresult/54ea769ed40cf7a","status":"passed","time":{"start":1702843529245,"stop":1702843530874,"duration":1629}},{"uid":"84ba721d3164ca4f","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1270//#testresult/84ba721d3164ca4f","status":"passed","time":{"start":1702809356705,"stop":1702809358618,"duration":1913}},{"uid":"4af8a946cdff34cf","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1247//#testresult/4af8a946cdff34cf","status":"passed","time":{"start":1702657112568,"stop":1702657114278,"duration":1710}},{"uid":"39938702e252c4c","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1244//#testresult/39938702e252c4c","status":"passed","time":{"start":1702603157996,"stop":1702603159489,"duration":1493}},{"uid":"2b7b87e85921c8f","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1243//#testresult/2b7b87e85921c8f","status":"passed","time":{"start":1702540025309,"stop":1702540027616,"duration":2307}},{"uid":"f03214e17aec06ab","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1241//#testresult/f03214e17aec06ab","status":"passed","time":{"start":1702516652806,"stop":1702516654245,"duration":1439}},{"uid":"b0e3dd5107def926","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1238//#testresult/b0e3dd5107def926","status":"passed","time":{"start":1702447456132,"stop":1702447457842,"duration":1710}},{"uid":"a327da3de97df845","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1237//#testresult/a327da3de97df845","status":"passed","time":{"start":1702447417760,"stop":1702447419409,"duration":1649}},{"uid":"5a5cabd5687538d","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1236//#testresult/5a5cabd5687538d","status":"passed","time":{"start":1702430308072,"stop":1702430309477,"duration":1405}},{"uid":"aee5830cc7074155","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1232//#testresult/aee5830cc7074155","status":"passed","time":{"start":1702366474839,"stop":1702366476729,"duration":1890}},{"uid":"8edfc364d85ed138","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1231//#testresult/8edfc364d85ed138","status":"passed","time":{"start":1702343929402,"stop":1702343931183,"duration":1781}},{"uid":"8e16ba9ea5190301","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1229//#testresult/8e16ba9ea5190301","status":"passed","time":{"start":1702257527533,"stop":1702257529350,"duration":1817}}]},"tags":[]},"source":"120f6c25e7b7a91e.json","parameterValues":["CharnwoodBoroughCouncil","None","None"]}