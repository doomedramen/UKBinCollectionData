{"uid":"bbde33b67a514a3c","name":"Validate Council Output [TonbridgeAndMallingBC-None-None]","fullName":"features/validate_council_outputs.feature:Validate Council Output","historyId":"b2d5541e3bec21fe5654b039ca862869","time":{"start":1709512167704,"stop":1709512169036,"duration":1332},"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"fixturefunc = <function scrape_step at 0x7f0c22fc6e60>\nrequest = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f0c2227a080>, 'council': 'TonbridgeAndMallingBC', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:92: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:96: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:115: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:78: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f0c21db4910>, page = ''\nkwargs = {'headless': True, 'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', ...}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2024, 3, 4, 0, 29, 29, 35296)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:73: AttributeError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"fixturefunc = <function scrape_step at 0x7f0c22fc6e60>\nrequest = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC-None-None]>>\nkwargs = {'context': <test_validate_council.context.<locals>.Context object at 0x7f0c2227a080>, 'council': 'TonbridgeAndMallingBC', 'selenium_mode': 'None', 'selenium_url': 'None'}\n\n    def call_fixture_func(\n        fixturefunc: \"_FixtureFunc[FixtureValue]\", request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/_pytest/fixtures.py:902: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuk_bin_collection/tests/step_defs/test_validate_council.py:92: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:96: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:115: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:78: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f0c21db4910>, page = ''\nkwargs = {'headless': True, 'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', ...}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2024, 3, 4, 0, 29, 29, 35296)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:73: AttributeError","steps":[{"name":"Given the council: TonbridgeAndMallingBC","time":{"start":1709512167704,"stop":1709512167705,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"When we scrape the data from TonbridgeAndMallingBC using None and the None is set","time":{"start":1709512167705,"stop":1709512169036,"duration":1331},"status":"failed","statusMessage":"'NoneType' object has no attribute 'find'","statusTrace":"AttributeError: 'NoneType' object has no attribute 'find'\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"host","value":"fv-az573-660"},{"name":"thread","value":"2736-MainThread"},{"name":"framework","value":"pytest-bdd"},{"name":"language","value":"cpython3"},{"name":"feature","value":"Test each council output matches expected results"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"council","value":"TonbridgeAndMallingBC"},{"name":"selenium_mode","value":"None"},{"name":"selenium_url","value":"None"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":199,"unknown":0,"total":200},"items":[{"uid":"7bdb10b668d7fa17","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1572//#testresult/7bdb10b668d7fa17","status":"passed","time":{"start":1708561703301,"stop":1708561705314,"duration":2013}},{"uid":"1a07e3c76979dac0","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1570//#testresult/1a07e3c76979dac0","status":"passed","time":{"start":1708475278645,"stop":1708475287965,"duration":9320}},{"uid":"856b36ebcdf4794c","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1569//#testresult/856b36ebcdf4794c","status":"passed","time":{"start":1708388890953,"stop":1708388893373,"duration":2420}},{"uid":"fd623156c96db948","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1568//#testresult/fd623156c96db948","status":"passed","time":{"start":1708302612798,"stop":1708302615898,"duration":3100}},{"uid":"1dbc3e375b1ea364","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1567//#testresult/1dbc3e375b1ea364","status":"passed","time":{"start":1708216245835,"stop":1708216247796,"duration":1961}},{"uid":"fce67ba6a1fbc6b3","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1566//#testresult/fce67ba6a1fbc6b3","status":"passed","time":{"start":1708129813034,"stop":1708129815799,"duration":2765}},{"uid":"fe3271771ccfbe08","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1563//#testresult/fe3271771ccfbe08","status":"passed","time":{"start":1708043292202,"stop":1708043294896,"duration":2694}},{"uid":"edb83e00314c002a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1562//#testresult/edb83e00314c002a","status":"passed","time":{"start":1707956887551,"stop":1707956889977,"duration":2426}},{"uid":"146ecb53f12d4259","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1561//#testresult/146ecb53f12d4259","status":"passed","time":{"start":1707870627826,"stop":1707870630560,"duration":2734}},{"uid":"a6a15ce56afbab8","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1560//#testresult/a6a15ce56afbab8","status":"passed","time":{"start":1707784153684,"stop":1707784156121,"duration":2437}},{"uid":"9cfd7f8206f4a1c0","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1559//#testresult/9cfd7f8206f4a1c0","status":"passed","time":{"start":1707697749731,"stop":1707697752267,"duration":2536}},{"uid":"4ce2f64be73893d","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1556//#testresult/4ce2f64be73893d","status":"passed","time":{"start":1707611454124,"stop":1707611456031,"duration":1907}},{"uid":"9d03c09262bb27a3","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1554//#testresult/9d03c09262bb27a3","status":"passed","time":{"start":1707524865501,"stop":1707524868450,"duration":2949}},{"uid":"fef5a570ba6386b2","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1553//#testresult/fef5a570ba6386b2","status":"passed","time":{"start":1707438493023,"stop":1707438495611,"duration":2588}},{"uid":"2d29cc465e08c24a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1552//#testresult/2d29cc465e08c24a","status":"passed","time":{"start":1707352106527,"stop":1707352109409,"duration":2882}},{"uid":"ae1bfe19e13963ea","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1551//#testresult/ae1bfe19e13963ea","status":"passed","time":{"start":1707265635694,"stop":1707265642507,"duration":6813}},{"uid":"dbab7928d9c36f62","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1549//#testresult/dbab7928d9c36f62","status":"passed","time":{"start":1707179316875,"stop":1707179319064,"duration":2189}},{"uid":"e11c84b95141724b","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1548//#testresult/e11c84b95141724b","status":"passed","time":{"start":1707093034673,"stop":1707093036728,"duration":2055}},{"uid":"ce5ba09262db6639","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1547//#testresult/ce5ba09262db6639","status":"passed","time":{"start":1707006669357,"stop":1707006672056,"duration":2699}},{"uid":"dd1e356667c1c9e7","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/1545//#testresult/dd1e356667c1c9e7","status":"passed","time":{"start":1706941998225,"stop":1706942000722,"duration":2497}}]},"tags":[]},"source":"bbde33b67a514a3c.json","parameterValues":["TonbridgeAndMallingBC","None","None"]}